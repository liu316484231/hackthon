<!DOCTYPE html>
<html>
<head>
   <meta charset="utf-8">
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <title>å¥³ç¥æƒ…æ„Ÿæ¢æµ‹å™¨</title>
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.4/css/bulma.min.css">
   <link rel="stylesheet" href="stylesheets/style.css">
   <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
   <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
   <script src="javascripts/jquery.min.js"></script>
   <!--high charts-->
   <script src="https://img.highcharts.com.cn/highcharts/highcharts.js"></script>
   <script src="https://img.highcharts.com.cn/highcharts/modules/exporting.js"></script>
   <script src="https://img.highcharts.com.cn/highcharts/modules/series-label.js"></script>
   <script src="https://img.highcharts.com.cn/highcharts/modules/oldie.js"></script>
   <script src="https://img.highcharts.com.cn/highcharts-plugins/highcharts-zh_CN.js"></script>
   <script src="https://img.highcharts.com.cn/highcharts/themes/sand-signika.js"></script>
</head>
<body>
<section class="section">
   <div class="container">
      <h2 class="title is-3 t1"><i class="fas fa-heart"></i>&nbsp;å¥³ç¥æƒ…æ„Ÿæ¢æµ‹å™¨&nbsp;<i class="far fa-heart"></i></h2>
      <div class="tile is-ancestor">
         <div class="tile is-vertical is-5">
            <div class="tile">
               <div class="tile is-parent is-vertical">
                  <article class="tile is-child notification is-primary">
                     <p class="title">èŠå¤©è¾“å…¥ï¼š</p>
                     <!--<p class="subtitle">Top tile</p>-->
                     <textarea id="box" class="textarea" placeholder="è®°å½•.." rows="17"></textarea>
                     <br/>
                     <input id="msg" class="input is-rounded is-danger" type="text" placeholder="è¾“å…¥.."/>
                     <br/>
                     <br/>
                     <a class="button is-danger is-fullwidth is-rounded" onclick="submit()">æäº¤</a>
                  </article>
               </div>
            </div>
         </div>
         <div class="tile is-parent">
            <article class="tile is-child notification is-success">
               <div class="content">
                  <p class="title">æƒ…æ„Ÿåˆ†æï¼š</p>
                  <div class="content">
                     <div class="card">
                        <header class="card-header">
                           <p class="card-header-title">
                              ç»¼åˆæƒ…æ„Ÿå¾—åˆ†:<span id="avgScore"></span>
                           </p>
                        </header>
                     </div>
                     <br/>
                     <div class="card">
                        <div id="chart" style="min-width:400px;height:400px"></div>
                     </div>
                     <br/>
                     <div class="card">
                        <header class="card-header">
                           <p class="card-header-title">
                             å»ºè®®å›å¤:
                              <span id="suggest"></span>
                           </p>
                        </header>
                     </div>
                     <!-- Content -->
                  </div>
               </div>
            </article>
         </div>
      </div>
   </div>
</section>
</body>
</html>

<script>
    let data_list = [];
    let chart = refreshChart();

    const mood_good = ["å¼€å¿ƒæ‘¸æ‘¸å“’~","ğŸ˜˜ğŸ˜˜ğŸ˜˜ğŸ˜˜ğŸ˜˜","å—¯å—¯ï¼","â˜ºâ˜ºâ˜º","ğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜Š","ğŸ˜„ğŸ˜„ğŸ˜„","ãƒ¾(oâ—•âˆ€â—•)ï¾‰ãƒ¾","ğŸ˜‹ğŸ˜‹ğŸ˜‹ğŸ˜‹ğŸ˜‹"];
    const mood_bad = ["åˆ«ä¼¤å¿ƒå‘€", "æˆ‘é”™äº†ï¼ï¼","ğŸ˜­ğŸ˜­ğŸ˜­ğŸ˜­ğŸ˜­", "æ²¡å…³ç³»","ğŸ’”ğŸ’”ğŸ’”ğŸ’”ğŸ’”", "ğŸ˜ğŸ˜ğŸ˜", "ğŸ˜£ğŸ˜£ğŸ˜£ğŸ˜£ğŸ˜£", "ğŸ˜ˆğŸ˜ˆğŸ˜ˆ"];
    const mood_mid = ["ä½ å¥½å‘€ï¼"];

    function submit(){
        let msg = $("#msg").val();
        if(msg == null || msg.trim() === ""){
            alert("è¾“å…¥ä¸ºç©º,è¯·é‡æ–°è¾“å…¥");
            return;
        }
        //ajax
        $.get("http://10.23.1.2:8001//baidu?text=" + msg, function(data){
            // alert(JSON.stringify(data));
            let res = data.data;
            let score = Math.floor(res.confd * 100);
            let type = res.polar;
            // let score = Math.floor(Math.random() * 100);
            let mood = "";
            if(type === 1){
                mood = "æ­£é¢";
            }else if(type === 0){
                mood = "ä¸­æ€§";
                score = 50;
            }else {
                mood = "è´Ÿé¢";
                score = 100 - score;
            }
            let suggest = "";
            let sum = 0;
            data_list.push(score);
            chart = refreshChart();

            data_list.forEach(function(data){
                sum += data;
            });
            let avgScore = Math.floor(sum/data_list.length);
            if(score > 50){
                suggest = getRand(mood_good);
            }else if(score === 50){
                suggest = getRand(mood_mid);
            }else {
                suggest = getRand(mood_bad);
            }
            $("#box").append(msg + "ã€å¾—åˆ†:" + score + "ã€‘" + "ã€æƒ…æ„Ÿ:" + mood + "ã€‘" + "\n");
            //æ ¹æ®avgæ¨èå›å¤
            $("#suggest").html(suggest);
            $("#avgScore").html(avgScore);
        });

    }

    function refreshChart(){
        return Highcharts.chart('chart', {
            title: {
                text: 'æƒ…æ„Ÿåˆ†ææ›²çº¿'
            },
            yAxis: {
                title: {
                    text: 'æƒ…æ„Ÿå¾—åˆ†(0-100)'
                }
            },
            legend: {
                layout: 'vertical',
                align: 'right',
                verticalAlign: 'middle'
            },
            plotOptions: {
                series: {
                    label: {
                        connectorAllowed: false
                    },
                    pointStart: 1
                }
            },
            series: [
                {
                    name: 'æƒ…æ„Ÿåˆ†æ•°',
                    data: data_list
                }],
            responsive: {
                rules: [{
                    condition: {
                        maxWidth: 500
                    },
                    chartOptions: {
                        legend: {
                            layout: 'horizontal',
                            align: 'center',
                            verticalAlign: 'bottom'
                        }
                    }
                }]
            }
        });
    }

    function getRand(list){
        let index = Math.floor(Math.random() * list.length);
        return list[index];
    }
</script>